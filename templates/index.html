{% extends "base.html" %}

{% block content %}
<div class="container-fluid">

    <!-- Fila de Tarjetas -->
    <div class="row">

        <!-- Tarjeta de Productos -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body d-flex align-items-center">
                    <div class="mr-3">
                        <i class="fas fa-box fa-2x text-gray-300"></i>
                    </div>
                    <div>
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                            Productos
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ total_products | format_number }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tarjeta de Tiendas -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body d-flex align-items-center">
                    <div class="mr-3">
                        <i class="fas fa-store fa-2x text-gray-300"></i>
                    </div>
                    <div>
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            Tiendas
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ total_stores | format_number }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tarjeta de Precios -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body d-flex align-items-center">
                    <div class="mr-3">
                        <i class="fas fa-tags fa-2x text-gray-300"></i>
                    </div>
                    <div>
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                            Precios
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ total_prices | format_number }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div><!-- Fin fila de tarjetas -->

    <!-- Gráficos -->
    <div class="row">
        <!-- Gráfico Atun en agua -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Evolución de precios: Atun en agua</h6>
                </div>
                <div class="card-body">
                    <div id="chart-atun" style="height: 350px;"></div>
                </div>
            </div>
        </div>

        <!-- Gráfico Deviled Ham -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Evolución de precios: Deviled Ham</h6>
                </div>
                <div class="card-body">
                    <div id="chart-deviled" style="height: 350px;"></div>
                </div>
            </div>
        </div>
    </div><!-- Fin row de gráficos -->

</div>
{% endblock %}

{% block scripts %}
<!-- Incluye Plotly (o Chart.js) si no lo tienes ya -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
// Función para cargar datos y graficar en un div específico
function loadChartData(product, containerId) {
    fetch('/api/dashboard_chart_data?product=' + encodeURIComponent(product))
      .then(response => response.json())
      .then(data => {
          if (data.error) {
              console.error(data.error);
              return;
          }
          const traces = [];
          data.data.forEach(series => {
              traces.push({
                  x: series.dates,
                  y: series.prices,
                  mode: 'lines+markers',
                  name: series.label
              });
          });
          const layout = {
              title: data.title,
              xaxis: { title: 'Fecha' },
              yaxis: { title: 'Precio (sin decimales)' }
          };
          Plotly.newPlot(containerId, traces, layout);
      })
      .catch(err => console.error(err));
}

// Cargar gráficos para Atun en agua y Deviled Ham
loadChartData('Atun en agua', 'chart-atun');
loadChartData('Deviled Ham', 'chart-deviled');
</script>
{% endblock %}



