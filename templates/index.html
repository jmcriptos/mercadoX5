{% extends "base.html" %}

{% block content %}
<div class="container">
    <!-- Tarjetas resumen -->
    <div class="row">
        <div class="col-md-4">
            <div class="card text-white bg-primary mb-3">
                <div class="card-header">Productos</div>
                <div class="card-body">
                    <h5 class="card-title">{{ "{:,.0f}".format(total_products)|replace(",", ".") }}</h5>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-success mb-3">
                <div class="card-header">Tiendas</div>
                <div class="card-body">
                    <h5 class="card-title">{{ "{:,.0f}".format(total_stores)|replace(",", ".") }}</h5>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-info mb-3">
                <div class="card-header">Precios Registrados</div>
                <div class="card-body">
                    <h5 class="card-title">{{ "{:,.0f}".format(total_prices)|replace(",", ".") }}</h5>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección de gráficos -->
    {% for graph in product_graphs %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title">{{ graph.name }}</h5>
        </div>
        <div class="card-body">
            <!-- Contenedor único para el gráfico, usando el id del producto -->
            <div id="graph-{{ graph.id }}" style="height: 300px;"></div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
{% block scripts %}
<script>
    // Los datos de los gráficos se pasan desde Flask y se convierten a JSON
    const productGraphs = {{ product_graphs | tojson }};
    productGraphs.forEach(function(graph) {
        const data = [{
            x: graph.dates,
            y: graph.prices,
            mode: 'lines+markers',
            type: 'scatter'
        }];
        const layout = {
            title: 'Precios de ' + graph.name,
            xaxis: { title: 'Fecha' },
            yaxis: { title: 'Precio', tickformat: ',.0f' } // Sin decimales y con separador de miles (ajusta según sea necesario)
        };
        Plotly.newPlot('graph-' + graph.id, data, layout);
    });
</script>
{% endblock %}






